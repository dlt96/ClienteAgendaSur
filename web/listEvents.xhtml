<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:b="http://bootsfaces.net/ui">
    <h:head>
        <title>Agenda Sur</title>
    </h:head>
    <h:body>
        <b:container fluid="true" contentDisabled="false">
            <br/>
            <h:form>
                <b:row contentDisabled="false">
                    <b:column span="1" contentDisabled="false"></b:column>
                    <b:column span="10" contentDisabled="false">
                        <b:row contentDisabled="false">
                            <b:column span="2" contentDisabled="false">
                                <b:commandButton value="Nuevo evento" look="info" action="#{UserBean.doCrear()}"/> 
                            </b:column>
                            <b:column span="1" contentDisabled="false">
                                <b:commandButton value="Show only: " look="info" action="#{listadoEventos.showTags()}"/> 
                            </b:column>
                            <b:column span="2" contentDisabled="false">
                                <b:selectOneMenu value="#{listadoEventos.tagSelected}">
                                    <f:selectItem itemValue="--" itemLabel="Order by Date" />
                                    <f:selectItems value="#{listadoEventos.listaTags}" var="tag" itemValue="#{tag.nombre}" itemLabel="#{tag.nombre}" />
                                </b:selectOneMenu>
                            </b:column>
                            <b:column span="2" contentDisabled="false">
                                <b:commandButton value="Ordenar por Geolocalizacion" look="success" onclick="getPosition()"/>
                                <h:inputHidden id="geoLatitude" value="#{listadoEventos.latitude}" />
                                <h:inputHidden id="geoLongitude" value="#{listadoEventos.longitude}" />
                                <b:commandButton id="buttonGeo" style="display: none" action="#{listadoEventos.orderByLocation}" />
                            </b:column>
       
                            <script type="text/javascript">
                                function getPosition(){
                                    navigator.geolocation.getCurrentPosition(getVars);
                                }
                                
                                function getVars() {
                                    var x = position.coords.longitude;
                                    var y = position.coords.latitude;
                                    
                                    document.getElementById("geoLatitude").value = x;
                                    document.getElementById("geoLongitude").value = y;
                                    document.getElementById("buttonGeo").click();
                                }
                            </script> 
                                
                        </b:row>
                        <b:row contentDisabled="false"> <br/> </b:row>
                        <b:dataTable value="#{listadoEventos.listaEventos}" var="evento" page-length="5" page-length-menu="5,10,20">
                            <f:facet name="header">
                                <tr>
                                    <th>Nombre</th>
                                    <th>Descripcion</th>
                                    <th>Fecha inicio</th>
                                    <th>Fecha fin</th>
                                    <th>Ubicacion</th>
                                    <th>Acciones</th>
                                </tr>
                            </f:facet>
                            <b:dataTableColumn value="#{evento.nombre}"/> 
                            <b:dataTableColumn value="#{evento.descripcion}"/> 
                            <b:dataTableColumn value="#{evento.fechainicio.toString().substring(0,10)} #{evento.fechainicio.toString().substring(11,19)}" order="asc"/> 
                            <b:dataTableColumn value="#{evento.fechafin.toString().substring(0,10)} #{evento.fechafin.toString().substring(11,19)}"/> 
                            <b:dataTableColumn value="#{evento.direccion}"/> 
                            <b:dataTableColumn>
                                <b:row contentDisabled="false">
                                    <b:column span="1"></b:column>
                                    <b:column span="3" contentDisabled="false" rendered="#{UserBean.journalist}">
                                        <b:commandButton value="Editar" look="warning" action="#{deleteAndModifyEvent.doEditar(evento)}" />
                                    </b:column>
                                    <b:column span="3" contentDisabled="false" rendered="#{UserBean.journalist}">
                                        <b:commandButton value="Borrar" look="danger" action="#{deleteAndModifyEvent.doEliminar(evento)}" />
                                    </b:column>
                                    <b:column span="3" contentDisabled="false">
                                        <b:commandButton value="Ver Evento" look="info" action="#{UserBean.cargarEvento(evento)}"/>
                                    </b:column>
                                </b:row>
                            </b:dataTableColumn> 
                        </b:dataTable>
                    </b:column>
                    <b:column span="1" contentDisabled="false"></b:column>
                </b:row>
            </h:form>
        </b:container>
    </h:body>
</html>

